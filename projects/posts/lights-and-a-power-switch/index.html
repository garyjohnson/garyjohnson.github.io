<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Bluetooth Build Button, Part 6: lights and a power switch - Gary’s Work in Progress</title>
<meta name="description" content="With a basic software implementation completed (Part 5: the software), we can spend some time using it day-to-day and build incremental improvements.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Gary's Work in Progress">
<meta property="og:title" content="Bluetooth Build Button, Part 6: lights and a power switch">
<meta property="og:url" content="http://garyjohnson.github.io/projects/posts/lights-and-a-power-switch/">


  <meta property="og:description" content="With a basic software implementation completed (Part 5: the software), we can spend some time using it day-to-day and build incremental improvements.">



  <meta property="og:image" content="http://garyjohnson.github.io/images/button06/button-cover-top.jpg">





  <meta property="article:published_time" content="2019-03-19T10:29:00+00:00">






<link rel="canonical" href="http://garyjohnson.github.io/projects/posts/lights-and-a-power-switch/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "http://garyjohnson.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Gary's Work in Progress Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Gary's Work in Progress
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/projects/">Projects</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero"
  style=" background-image: url('');"
>
  
    <img src="/images/button06/button-cover-top.jpg" alt="Bluetooth Build Button, Part 6: lights and a power switch" class="page__hero-image">
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Bluetooth Build Button, Part 6: lights and a power switch">
    <meta itemprop="description" content="With a basic software implementation completed (Part 5: the software), we can spend some time using it day-to-day and build incremental improvements.">
    <meta itemprop="datePublished" content="2019-03-19T10:29:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Bluetooth Build Button, Part 6: lights and a power switch
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>With <a href="/projects/posts/software/">a basic software implementation completed (Part 5: the software)</a>, we can spend some time using it day-to-day and build incremental improvements.</p>

<h2 id="power-switch">Power switch</h2>

<p>I mentioned previously that I was opening the enclosure to turn the button on and off, so streamlining that behavior is my first target.</p>

<p>A little bit of time in Fusion 360, and I have a mount for the power switch. It’s meant to be a bit of a tight fit, as the switch should hopefully “snap” into the enclosure.</p>

<p><img src="/images/button06/switch-model.gif" alt="mount for switch" /></p>

<p>The first print ended up being way too tight, so after destroying it with pliers, it’s back to Fusion for a few tweaks, and finally I have something that works:</p>

<p><img src="/images/button06/switch-inside.jpg" alt="switch inside" /></p>

<p><img src="/images/button06/switch-outside.jpg" alt="switch outside" /></p>

<p>It’s connected to <a href="https://learn.adafruit.com/assets/43921">VREG ENABLE (labelled ‘EN’) on the Feather</a> – which will prevent the Feather from getting 3.3V from the battery.</p>

<p><br /></p>
<video controls="controls" name="switch" src="/images/button06/switch.mp4" poster="/images/button06/switch-thumbnail.jpg" preload="auto"></video>
<p><br /></p>

<p>After a little bit of use, it seems to work well! I still haven’t done any real math to figure out battery life, but switching it on during the work day and off at night has allowed me to use it for days without needing a charge.</p>

<h2 id="led-ring">LED ring</h2>

<p>Previously, I created handling for three stages of button push – short, medium, long. In vim-test, respectively, those run a single test, the test file, and the entire test suite. But there’s no feedback to let you know how long to press or what stage you’re running.</p>

<p>Given the cylindrical enclosure, I really liked the idea of including a <a href="https://www.adafruit.com/product/1586">NeoPixel ring</a> and using it as a feedback mechanism, but I wasn’t 100% sure that I could build something effective. Remembering the sketch from the <a href="/articles/new-project">first post</a>:</p>

<p><img src="/images/button06/button-io.jpg" alt="button io" /></p>

<p>I started by building the interaction with all the components on a breadboard:</p>

<p><img src="/images/button06/led-breadboard.jpg" alt="led ring on breadboard" /></p>

<p>And then get to work on creating a lid that can house the LED ring. This ends up being slightly tricky because the NeoPixel ring has GND + VIN on one side of the ring, and the data bus on the opposite side, so we need channels for wires to run on both sides of the lid:</p>

<p><img src="/images/button06/led-lid.gif" alt="lid for led ring" /></p>

<p>Thankfully it fits pretty good on the first print.</p>

<p><img src="/images/button06/led-in-lid.jpg" alt="printed lid" /></p>

<p>The interation works pretty well – the ring cycles through blue, purple, and then red. Releasing on any of those stages triggers the appropriate test run.
<br /></p>
<video controls="controls" name="leds bright" src="/images/button06/leds-bright.mp4" poster="/images/button06/leds-bright-thumbnail.jpg" preload="auto"></video>
<p><br />
It’s very bright though, so back to Fusion 360 to create a quick diffuser ring to snap over the LEDs.
<br /></p>
<video controls="controls" name="leds diffuser" src="/images/button06/led-diffuser.mp4" poster="/images/button06/led-diffuser-thumbnail.jpg" preload="auto"></video>
<p><br /></p>

<h2 id="three-problems-to-solve">Three problems to solve</h2>

<p>The LED feedback has been working great so far. But after about a week of use I can identify three problems:</p>

<h3 id="feedback">Feedback</h3>

<p>When I tap the button quickly, the LEDs just turn off. It’d be great if there was some confirmation feedback to communicate which stage I triggered (blinking the LEDs in blue, purple or red).</p>

<h3 id="battery-life">Battery life</h3>

<p>The power switch isn’t a hard cut to the battery line – the EN pin just disables the 3.3v regulator for the Feather. This means that the NeoPixels continue to draw power even when they are not lit up, and suddenly I’ve gone from having week-long battery life to needing a charge every day. I’m probably going to want to build a carrier board for the feather to enable a proper off switch.</p>

<h3 id="mysterious-crashes">Mysterious crashes</h3>

<p>I’ve hit a blocker in continuing to build the software, which is that I can’t seem to change the code in even mundane ways without causing runtime errors I can’t debug. In this state, the code compiles, it appears I have pleny of memory, but the Feather just doesn’t seem to run. Without a JTAG debugger I’m flying blind here, but I’m going to have to figure out how to solve this if I want to move forward.</p>

<h2 id="whats-next">What’s next</h2>

<p>Solving those runtime crashes is threatening to kill my momentum, so it’s priority number one.</p>

<p>Next: <a href="/projects/posts/crashes-and-animations/">crashes and animations</a></p>


        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-03-19T10:29:00+00:00">March 19, 2019</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Bluetooth+Build+Button%2C+Part+6%3A+lights+and+a+power+switch%20http%3A%2F%2Fgaryjohnson.github.io%2Fprojects%2Fposts%2Flights-and-a-power-switch%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fgaryjohnson.github.io%2Fprojects%2Fposts%2Flights-and-a-power-switch%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fgaryjohnson.github.io%2Fprojects%2Fposts%2Flights-and-a-power-switch%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/projects/posts/software/" class="pagination--pager" title="Bluetooth Build Button, Part 5: the software
">Previous</a>
    
    
      <a href="/projects/posts/crashes-and-animations/" class="pagination--pager" title="Bluetooth Build Button, Part 7: crashes and animations
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/projects/posts/crashes-and-animations/" rel="permalink">Bluetooth Build Button, Part 7: crashes and animations
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Previously, we added LEDs for feedback (Part 6: lights and a power switch), and ended up with a number of problems to fix. The most blocking was an issue whe...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/projects/posts/software/" rel="permalink">Bluetooth Build Button, Part 5: the software
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Now that v1.0 is out of the way (Part 4: v1.0 complete), we can spend some time using it day-to-day and build incremental improvements.

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/projects/posts/build-button-v1/" rel="permalink">Bluetooth Build Button, Part 4: v1.0 complete
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">With the rough-ins in place (Part 3: the enclosure rough-ins), we can build out the enclosure.

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/projects/posts/enclosure-rough-ins/" rel="permalink">Bluetooth Build Button, Part 3: the enclosure rough-ins
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">With the core idea now functional (Part 2: the proof-of-concept), it’s time to start working on a proper enclosure.

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Gary's Work in Progress. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
